<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--=============== REMIXICONS ===============-->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">

    <!--=============== CSS (re‑use the same stylesheet) ===============-->
    <link rel="stylesheet" href="styles.css">

    <style>
        /* === Modal overlay === */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .modal {
            background: hsla(0, 0%, 10%, 0.9);
            border: 2px solid #fff;
            padding: 2rem 1.5rem;
            border-radius: 1rem;
            backdrop-filter: blur(10px);
            width: 90%;
            max-width: 420px;
            max-height: 90vh;
            overflow: auto;
        }
        .modal code {
            user-select: all;
        }
    </style>

    <title>BLUE16 - Admin Panel</title>
</head>
<body>
<section>
    <!-- background wave reuse -->
    <div class="wave">
        <span></span>
        <span></span>
        <span></span>
    </div>

    <!-- ================= Admin login ================= -->
    <div class="container" id="login-container">
        <h1 class="login__title">Admin Login</h1>
        <div class="login__content">
            <!-- username -->
            <div class="login__box">
                <i class="ri-user-3-line login__icon"></i>
                <div class="login__box-input">
                    <input type="text" required id="admin-user" class="login__input" placeholder=" ">
                    <label for="admin-user" class="login__label">Username</label>
                </div>
            </div>
            <!-- password -->
            <div class="login__box">
                <i class="ri-lock-2-line login__icon"></i>
                <div class="login__box-input">
                    <input type="password" required id="admin-pass" class="login__input" placeholder=" ">
                    <label for="admin-pass" class="login__label">Password</label>
                    <i class="ri-eye-off-line login__eye" id="admin-pass-eye"></i>
                </div>
            </div>
        </div>
        <button id="admin-login-btn" class="login__button">Login</button>
    </div>

    <!-- ================= Invite‑key generator ================= -->
    <div class="container" id="panel-container" style="display:none;">
        <h1 class="login__title">Invite Key Generator</h1>
        <button id="open-generator" class="login__button">Generate Invite Keys</button>

        <h2 class="login__title" style="margin-top:2rem;">Latest Keys</h2>
        <div id="keys-list" style="max-height:240px; overflow:auto;"></div>
    </div>
</section>

<!-- ========== Modal template (cloned at runtime) ========== -->
<template id="modal-template">
    <div class="modal-overlay">
        <div class="modal">
            <h2 class="login__title">Generate Invite Keys</h2>
            <div class="login__content">
                <div class="login__box">
                    <i class="ri-hashtag login__icon"></i>
                    <div class="login__box-input">
                        <input type="number" min="1" id="key-count" class="login__input" placeholder=" ">
                        <label for="key-count" class="login__label">How many keys?</label>
                    </div>
                </div>
            </div>
            <button id="generate-btn" class="login__button">Generate</button>
            <button id="close-btn" class="login__button" style="margin-top:1rem; background:#e74c3c; color:#fff;">Close</button>
            <div id="generated-keys" style="margin-top:1.5rem; max-height:200px; overflow:auto;"></div>
        </div>
    </div>
</template>

<div id="notification-container"></div>

<!-- ========== Supabase + logic ========== -->
<script
  src="https://js-de.sentry-cdn.com/e2a8ad2c9f62481f8da08c3075f4326e.min.js"
  crossorigin="anonymous"
></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
    /* -----------------------------------------
       Supabase initialisation (reuse anon key)
       -----------------------------------------
       Create a table `invite_keys` with columns:
       key TEXT PRIMARY KEY,
       used BOOLEAN DEFAULT FALSE,
       created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
    */
    const supabaseUrl = 'https://pspjvpipyvpvyixahsku.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBzcGp2cGlweXZwdnlpeGFoc2t1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyODU4MTQsImV4cCI6MjA2Mjg2MTgxNH0.K3qGEv9Pz-oSNfocFlVkh8ujQp0YZ85z9VlKGI1WXD8';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    /* -------------- Notifications -------------- */
    function showNotification(msg, type = 'success') {
        const container = document.getElementById('notification-container');
        const n = document.createElement('div');
        n.className = `notification ${type}`;
        n.textContent = msg;
        container.appendChild(n);
        setTimeout(() => n.classList.add('show'), 15);
        setTimeout(() => {
            n.classList.remove('show');
            setTimeout(() => n.remove(), 300);
        }, 3000);
    }

    /* -------- Eye‑toggle for admin password -------- */
    (function eyeToggle() {
        const input = document.getElementById('admin-pass');
        const eye = document.getElementById('admin-pass-eye');
        eye.addEventListener('click', () => {
            if (input.type === 'password') {
                input.type = 'text';
                eye.classList.replace('ri-eye-off-line', 'ri-eye-line');
            } else {
                input.type = 'password';
                eye.classList.replace('ri-eye-line', 'ri-eye-off-line');
            }
        });
    })();

    /* -------------- Admin authentication -------------- */
    const ADMIN_USER = 'BLUE16_Staff';
    const ADMIN_PASS = "(K4?'8h'Wx39"; // exact credential

myUndefinedFunction();

    document.getElementById('admin-login-btn').addEventListener('click', () => {
        const u = document.getElementById('admin-user').value.trim();
        const p = document.getElementById('admin-pass').value;
        if (u === ADMIN_USER && p === ADMIN_PASS) {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('panel-container').style.display = 'block';
            loadLatestKeys();
        } else {
            showNotification('Invalid credentials.', 'error');
        }
    });

    /* -------------- Key generator modal -------------- */
    document.getElementById('open-generator').addEventListener('click', openModal);

    function openModal() {
        const tmpl = document.getElementById('modal-template');
        const node = tmpl.content.cloneNode(true);
        document.body.appendChild(node);
        const overlay = document.querySelector('.modal-overlay');

        // Close
        overlay.querySelector('#close-btn').addEventListener('click', () => overlay.remove());

        // Generate keys
        overlay.querySelector('#generate-btn').addEventListener('click', async () => {
            const count = parseInt(overlay.querySelector('#key-count').value);
            if (!count || count <= 0) {
                showNotification('Enter a valid amount.', 'error');
                return;
            }
            const keys = [];
            const payload = [];
            for (let i = 0; i < count; i++) {
                const randArr = crypto.getRandomValues(new Uint32Array(1));
                const randStr = randArr[0].toString(36).toUpperCase().slice(0, 8);
                const key = `BLUE16_${randStr}`;
                keys.push(key);
                payload.push({ key, used: false });
            }
            const { error } = await supabase.from('invite_keys').insert(payload);
            if (error) {
                console.error(error);
                showNotification('Failed to save keys.', 'error');
                return;
            }
            overlay.querySelector('#generated-keys').innerHTML = keys.map(k => `<code>${k}</code>`).join('<br>');
            loadLatestKeys();
        });
    }

    /* -------------- Dashboard list -------------- */
    async function loadLatestKeys() {
        const { data, error } = await supabase
            .from('invite_keys')
            .select('*')
            .order('created_at', { ascending: false })
            .limit(100);
        if (error) {
            console.error(error);
            return;
        }
        const list = document.getElementById('keys-list');
        list.innerHTML = data.map(r => `<div>${r.key} — ${r.used ? '<span style="color:#e74c3c">USED</span>' : '<span style="color:#2ecc71">AVAILABLE</span>'}</div>`).join('');
    }
</script>
</body>
</html> <!--test-->