<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - BLUE16</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="dashboard.css">
    <script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Dashboard Layout -->
    <div class="dashboard-layout">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <img src="https://see.fontimg.com/api/rf5/nRoyY/YzA4MzM4MDJkMDY5NDQ4NDhmMjkxOTliNTQwMTAxZjMudHRm/Ymx1ZTE2/boblox-04-regular.png?r=fs&h=80&w=100&fg=FFFFFF&bg=FFFFFF&tb=1&s=65" alt="BLUE16" class="logo-sidebar">
                </div>
                <div class="sidebar-user">
                    <div class="user-avatar">
                        <span class="iconify" data-icon="mdi:account-circle"></span>
                    </div>
                    <div class="user-info">
                        <span class="user-name" id="sidebar-username">kitty</span>
                        <span class="user-status">Online</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-menu">
                <ul class="menu-list">
                    <li class="menu-item">
                        <a href="#" class="menu-link active" data-section="dashboard">
                            <span class="iconify" data-icon="mdi:view-dashboard"></span>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="download">
                            <span class="iconify" data-icon="mdi:download"></span>
                            <span>Download</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="files">
                            <span class="iconify" data-icon="mdi:folder"></span>
                            <span>Files</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="games">
                            <span class="iconify" data-icon="mdi:gamepad-variant"></span>
                            <span>Games</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="servers">
                            <span class="iconify" data-icon="mdi:server"></span>
                            <span>Servers</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="invites">
                            <span class="iconify" data-icon="mdi:key-variant"></span>
                            <span>Invites</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="notifications">
                            <span class="iconify" data-icon="mdi:bell"></span>
                            <span>Notifications</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="sidebar-footer">
                <ul class="menu-list">
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="profile">
                            <span class="iconify" data-icon="mdi:account"></span>
                            <span>Profile</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="settings">
                            <span class="iconify" data-icon="mdi:cog"></span>
                            <span>Settings</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="../index.html" class="menu-link">
                            <span class="iconify" data-icon="mdi:logout"></span>
                            <span>Logout</span>
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Header -->
            <header class="top-header">
                <div class="header-left">
                    <button class="sidebar-toggle" id="sidebarToggle">
                        <span class="iconify" data-icon="mdi:menu"></span>
                    </button>
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <button class="action-btn" id="notificationsBtn">
                            <span class="iconify" data-icon="mdi:bell"></span>
                            <span class="notification-badge">3</span>
                        </button>
                        <button class="action-btn" id="profileBtn">
                            <span class="iconify" data-icon="mdi:account"></span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Content Sections -->
            <div class="content-wrapper">
                <!-- Dashboard Section -->
                <section class="content-section active" id="dashboard-section">
                    <div class="welcome-banner">
                        <div class="welcome-content">
                            <h2 class="welcome-title">Welcome back, <span class="gradient-text" id="username">kitty</span>!</h2>
                            <p class="welcome-subtitle">Ready to dive into some classic Roblox nostalgia?</p>
                        </div>
                        <div class="welcome-actions">
                            <button class="btn btn-primary">
                                <span class="iconify" data-icon="mdi:gamepad-variant"></span>
                                Start Playing
                            </button>
                            <button class="btn btn-secondary">
                                <span class="iconify" data-icon="mdi:server"></span>
                                Host Server
                            </button>
                        </div>
                    </div>

                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <span class="iconify" data-icon="mdi:gamepad-variant"></span>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">12</div>
                                <div class="stat-label">Games Played</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <span class="iconify" data-icon="mdi:server"></span>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">3</div>
                                <div class="stat-label">Servers Hosted</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <span class="iconify" data-icon="mdi:account-group"></span>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">24</div>
                                <div class="stat-label">Friends Online</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <span class="iconify" data-icon="mdi:medal"></span>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">8</div>
                                <div class="stat-label">Achievements</div>
                            </div>
                        </div>
                    </div>

                    <!-- Content Grid -->
                    <div class="content-grid">
                        <!-- Recent Activity -->
                        <div class="content-card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <span class="iconify" data-icon="mdi:history"></span>
                                    Recent Activity
                                </h3>
                                <button class="card-action">
                                    <span class="iconify" data-icon="mdi:dots-vertical"></span>
                                </button>
                            </div>
                            <div class="card-content">
                                <div class="activity-list">
                                    <div class="activity-item">
                                        <div class="activity-icon">
                                            <span class="iconify" data-icon="mdi:gamepad-variant"></span>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-title">Played "Classic Obby"</div>
                                            <div class="activity-time">2 hours ago</div>
                                        </div>
                                    </div>
                                    <div class="activity-item">
                                        <div class="activity-icon">
                                            <span class="iconify" data-icon="mdi:server"></span>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-title">Hosted "Friends Server"</div>
                                            <div class="activity-time">Yesterday</div>
                                        </div>
                                    </div>
                                    <div class="activity-item">
                                        <div class="activity-icon">
                                            <span class="iconify" data-icon="mdi:download"></span>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-title">Downloaded "Retro Racing"</div>
                                            <div class="activity-time">2 days ago</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="content-card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <span class="iconify" data-icon="mdi:lightbulb-on-outline"></span>
                                    Quick Actions
                                </h3>
                            </div>
                            <div class="card-content">
                                <div class="quick-actions">
                                    <button class="quick-action-btn">
                                        <span class="iconify" data-icon="mdi:download"></span>
                                        <span>Download Client</span>
                                    </button>
                                    <button class="quick-action-btn">
                                        <span class="iconify" data-icon="mdi:server"></span>
                                        <span>Create Server</span>
                                    </button>
                                    <button class="quick-action-btn">
                                        <span class="iconify" data-icon="mdi:folder"></span>
                                        <span>Upload Files</span>
                                    </button>
                                    <button class="quick-action-btn">
                                        <span class="iconify" data-icon="mdi:account-group"></span>
                                        <span>Invite Friends</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Latest News -->
                        <div class="content-card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <span class="iconify" data-icon="mdi:file-document-outline"></span>
                                    Latest News
                                </h3>
                                <button class="card-action">
                                    <span class="iconify" data-icon="mdi:arrow-top-right"></span>
                                </button>
                            </div>
                            <div class="card-content">
                                <div class="news-list">
                                    <div class="news-item">
                                        <div class="news-date">June 15, 2023</div>
                                        <h4 class="news-title">New Client Versions Available</h4>
                                        <p class="news-excerpt">We've added support for more classic Roblox clients. Check out the updated versions in the Download section!</p>
                                    </div>
                                    <div class="news-item">
                                        <div class="news-date">June 10, 2023</div>
                                        <h4 class="news-title">Community Server Hosting</h4>
                                        <p class="news-excerpt">Users can now host their own community servers. Visit the Servers section to get started!</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Server Status -->
                        <div class="content-card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <span class="iconify" data-icon="mdi:server-network"></span>
                                    Server Status
                                </h3>
                            </div>
                            <div class="card-content">
                                <div class="server-status" id="serverStatusList">
                                    <div class="status-item" id="status-main">
                                        <div class="status-indicator" id="status-main-ind"></div>
                                        <div class="status-info">
                                            <div class="status-name">Main Server</div>
                                            <div class="status-details" id="status-main-details">Checking...</div>
                                        </div>
                                    </div>
                                    <div class="status-item" id="status-game">
                                        <div class="status-indicator" id="status-game-ind"></div>
                                        <div class="status-info">
                                            <div class="status-name">Game Server</div>
                                            <div class="status-details" id="status-game-details">Checking...</div>
                                        </div>
                                    </div>
                                    <div class="status-item" id="status-file">
                                        <div class="status-indicator" id="status-file-ind"></div>
                                        <div class="status-info">
                                            <div class="status-name">File Server</div>
                                            <div class="status-details" id="status-file-details">Checking...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Download Section -->
                <section class="content-section" id="download-section">
                    <div class="section-header">
                        <h2 class="section-title">Download Launcher</h2>
                        <p class="section-subtitle">Get started with BLUE16 by downloading our launcher. The launcher will allow you to easily access all the classic Roblox clients and games.</p>
                    </div>
                    <div class="download-grid">
                        <div class="download-card">
                            <div class="download-icon">
                                <span class="iconify" data-icon="mdi:microsoft-windows"></span>
                            </div>
                            <h3 class="download-title">Windows</h3>
                            <p class="download-desc">Compatible with Windows 7 and above</p>
                            <button class="btn btn-primary download-btn" onclick="showDownloadPrompt('windows')">
                                <span class="iconify" data-icon="mdi:download"></span>
                                Download for Windows
                            </button>
                        </div>
                        <div class="download-card">
                            <div class="download-icon">
                                <span class="iconify" data-icon="mdi:apple"></span>
                            </div>
                            <h3 class="download-title">MacOS</h3>
                            <p class="download-desc">Compatible with MacOS 10.12 and above</p>
                            <button class="btn btn-primary download-btn" onclick="showDownloadPrompt('mac')">
                                <span class="iconify" data-icon="mdi:download"></span>
                                Download for MacOS
                            </button>
                        </div>
                        <div class="download-card">
                            <div class="download-icon">
                                <span class="iconify" data-icon="mdi:linux"></span>
                            </div>
                            <h3 class="download-title">Linux</h3>
                            <p class="download-desc">Compatible with most Linux distributions</p>
                            <button class="btn btn-primary download-btn" onclick="showDownloadPrompt('linux')">
                                <span class="iconify" data-icon="mdi:download"></span>
                                Download for Linux
                            </button>
                        </div>
                    </div>
                    <div class="download-notes">
                        <h3>Installation Notes</h3>
                        <ul class="notes-list">
                            <li>Make sure to check your antivirus software if the launcher is flagged</li>
                            <li>Our launcher is completely safe and open-source</li>
                            <li>For any issues, please visit our support page or contact us</li>
                        </ul>
                    </div>
                    <!-- Download prompt modal -->
                    <div id="downloadPromptModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(10,20,40,0.7); z-index:9999; align-items:center; justify-content:center;">
                        <div style="background:#1e2940; border-radius:16px; padding:32px 24px; max-width:350px; margin:auto; box-shadow:0 8px 32px rgba(33,150,243,0.18); text-align:center;">
                            <h3 style="color:#4fc3f7; margin-bottom:18px;">Choose Download Method</h3>
                            <p style="color:#b0b0b0; margin-bottom:24px;">Support development by downloading with ads, or get a direct link.</p>
                            <button class="btn btn-primary" id="directDownloadBtn" style="margin-bottom:12px; width:100%;">Direct Download</button>
                            <button class="btn btn-secondary" id="adDownloadBtn" style="width:100%;">Ad-Supported Download</button>
                            <br><br>
                            <button class="btn btn-sm" onclick="closeDownloadPrompt()" style="margin-top:10px;">Cancel</button>
                        </div>
                    </div>
                </section>

                <!-- Files Section -->
                <section class="content-section" id="files-section">
                    <div class="section-header">
                        <h2 class="section-title">Manage Your Files</h2>
                        <p class="section-subtitle">Upload, download, and manage your game files and resources.</p>
                    </div>

                    <div class="files-container">
                        <div class="upload-section">
                            <div class="upload-area">
                                <span class="iconify" data-icon="mdi:upload"></span>
                                <h3>Upload a File</h3>
                                <p>Drag and drop files here or click to browse</p>
                                <input type="file" id="fileInput" class="file-input" multiple>
                                <button class="btn btn-primary upload-btn">
                                    <span class="iconify" data-icon="mdi:upload"></span>
                                    Choose Files
                                </button>
                            </div>
                        </div>

                        <div class="files-list">
                            <div class="files-header">
                                <h3>Your Files</h3>
                                <div class="files-actions">
                                    <button class="btn btn-secondary">
                                        <span class="iconify" data-icon="mdi:download"></span>
                                        Download All
                                    </button>
                                </div>
                            </div>
                            <div class="file-items">
                                <div class="file-item">
                                    <div class="file-icon">
                                        <span class="iconify" data-icon="mdi:file"></span>
                                    </div>
                                    <div class="file-info">
                                        <div class="file-name">classic_obby.rbxl</div>
                                        <div class="file-details">2.3 MB • Uploaded 2 days ago</div>
                                    </div>
                                    <div class="file-actions">
                                        <button class="action-btn">
                                            <span class="iconify" data-icon="mdi:download"></span>
                                        </button>
                                        <button class="action-btn">
                                            <span class="iconify" data-icon="mdi:delete"></span>
                                        </button>
                                    </div>
                                </div>
                                <div class="file-item">
                                    <div class="file-icon">
                                        <span class="iconify" data-icon="mdi:file"></span>
                                    </div>
                                    <div class="file-info">
                                        <div class="file-name">retro_racing.rbxl</div>
                                        <div class="file-details">1.8 MB • Uploaded 1 week ago</div>
                                    </div>
                                    <div class="file-actions">
                                        <button class="action-btn">
                                            <span class="iconify" data-icon="mdi:download"></span>
                                        </button>
                                        <button class="action-btn">
                                            <span class="iconify" data-icon="mdi:delete"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Games Section -->
                <section class="content-section" id="games-section">
                    <div class="section-header">
                        <h2 class="section-title">Game Library</h2>
                        <p class="section-subtitle">Browse and download classic Roblox games.</p>
                    </div>

                    <div class="games-grid">
                        <div class="game-card">
                            <div class="game-image">
                                <img src="../src/img/placeholder.png" alt="Classic Obby">
                            </div>
                            <div class="game-content">
                                <h3 class="game-title">Classic Obby</h3>
                                <p class="game-desc">A nostalgic obstacle course from 2008</p>
                                <div class="game-meta">
                                    <span class="game-year">2008</span>
                                    <span class="game-players">1.2K players</span>
                                </div>
                                <button class="btn btn-primary game-btn">
                                    <span class="iconify" data-icon="mdi:download"></span>
                                    Download
                                </button>
                            </div>
                        </div>

                        <div class="game-card">
                            <div class="game-image">
                                <img src="../src/img/placeholder.png" alt="Retro Racing">
                            </div>
                            <div class="game-content">
                                <h3 class="game-title">Retro Racing</h3>
                                <p class="game-desc">Classic racing game from 2010</p>
                                <div class="game-meta">
                                    <span class="game-year">2010</span>
                                    <span class="game-players">856 players</span>
                                </div>
                                <button class="btn btn-primary game-btn">
                                    <span class="iconify" data-icon="mdi:download"></span>
                                    Download
                                </button>
                            </div>
                        </div>

                        <div class="game-card">
                            <div class="game-image">
                                <img src="../src/img/placeholder.png" alt="Old Tycoon">
                            </div>
                            <div class="game-content">
                                <h3 class="game-title">Old Tycoon</h3>
                                <p class="game-desc">Original tycoon game from 2009</p>
                                <div class="game-meta">
                                    <span class="game-year">2009</span>
                                    <span class="game-players">2.1K players</span>
                                </div>
                                <button class="btn btn-primary game-btn">
                                    <span class="iconify" data-icon="mdi:download"></span>
                                    Download
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Servers Section -->
                <section class="content-section" id="servers-section">
                    <div class="section-header">
                        <h2 class="section-title">Server Management</h2>
                        <p class="section-subtitle">Create and manage your own servers.</p>
                    </div>

                    <div class="servers-container">
                        <div class="server-actions">
                            <button class="btn btn-primary">
                                <span class="iconify" data-icon="mdi:plus"></span>
                                Create New Server
                            </button>
                        </div>

                        <div class="servers-grid">
                            <div class="server-card">
                                <div class="server-header">
                                    <div class="server-status online"></div>
                                    <h3 class="server-name">Friends Server</h3>
                                </div>
                                <div class="server-info">
                                    <p class="server-desc">Private server for friends</p>
                                    <div class="server-meta">
                                        <span class="server-players">5/20 players</span>
                                        <span class="server-uptime">2 hours</span>
                                    </div>
                                </div>
                                <div class="server-actions">
                                    <button class="btn btn-secondary">
                                        <span class="iconify" data-icon="mdi:cog"></span>
                                        Manage
                                    </button>
                                    <button class="btn btn-primary">
                                        <span class="iconify" data-icon="mdi:play"></span>
                                        Join
                                    </button>
                                </div>
                            </div>

                            <div class="server-card">
                                <div class="server-header">
                                    <div class="server-status offline"></div>
                                    <h3 class="server-name">Public Server</h3>
                                </div>
                                <div class="server-info">
                                    <p class="server-desc">Public server for everyone</p>
                                    <div class="server-meta">
                                        <span class="server-players">0/50 players</span>
                                        <span class="server-uptime">Offline</span>
                                    </div>
                                </div>
                                <div class="server-actions">
                                    <button class="btn btn-secondary">
                                        <span class="iconify" data-icon="mdi:cog"></span>
                                        Manage
                                    </button>
                                    <button class="btn btn-primary">
                                        <span class="iconify" data-icon="mdi:play"></span>
                                        Start
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Invites Section -->
                <section class="content-section" id="invites-section">
                    <div class="section-header">
                        <h2 class="section-title">Invite Management</h2>
                        <p class="section-subtitle">Generate and manage invite keys for BLUE16.</p>
                    </div>

                    <div class="invites-container">
                        <div class="invite-actions">
                            <button class="btn btn-primary">
                                <span class="iconify" data-icon="mdi:key-variant"></span>
                                Generate New Key
                            </button>
                        </div>

                        <div class="invites-list">
                            <div class="invite-item">
                                <div class="invite-key">BLUE16-ABC123-DEF456</div>
                                <div class="invite-info">
                                    <span class="invite-status active">Active</span>
                                    <span class="invite-uses">0/1 uses</span>
                                </div>
                                <div class="invite-actions">
                                    <button class="action-btn">
                                        <span class="iconify" data-icon="mdi:content-copy"></span>
                                    </button>
                                    <button class="action-btn">
                                        <span class="iconify" data-icon="mdi:delete"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Notifications Section -->
                <section class="content-section" id="notifications-section">
                    <div class="section-header">
                        <h2 class="section-title">Notifications</h2>
                        <p class="section-subtitle">Stay updated with BLUE16 news and updates.</p>
                    </div>

                    <div class="notifications-list">
                        <div class="notification-item unread">
                            <div class="notification-icon">
                                <span class="iconify" data-icon="mdi:bell"></span>
                            </div>
                            <div class="notification-content">
                                <div class="notification-title">New Client Available</div>
                                <div class="notification-message">A new classic Roblox client has been added to the download section.</div>
                                <div class="notification-time">2 hours ago</div>
                            </div>
                            <button class="notification-action">
                                <span class="iconify" data-icon="mdi:check"></span>
                            </button>
                        </div>

                        <div class="notification-item">
                            <div class="notification-icon">
                                <span class="iconify" data-icon="mdi:account-group"></span>
                            </div>
                            <div class="notification-content">
                                <div class="notification-title">Friend Request</div>
                                <div class="notification-message">JohnDoe wants to be your friend on BLUE16.</div>
                                <div class="notification-time">1 day ago</div>
                            </div>
                            <div class="notification-actions">
                                <button class="btn btn-secondary btn-sm">Accept</button>
                                <button class="btn btn-secondary btn-sm">Decline</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Profile Section -->
                <section class="content-section" id="profile-section">
                    <div class="section-header">
                        <h2 class="section-title">Profile</h2>
                        <p class="section-subtitle">Manage your public info and account security.</p>
                    </div>
                    <div class="profile-content" style="display:flex; gap:28px; align-items:flex-start; flex-wrap:wrap;">
                        <div class="profile-avatar" style="background:#121a2b; border:1px solid #24314d; border-radius:14px; padding:18px; display:flex; flex-direction:column; align-items:center; gap:12px; min-width:220px;">
                            <img id="avatar-preview" src="" alt="Avatar" style="width:96px; height:96px; border-radius:50%; object-fit:cover; border:2px solid #24314d; display:none;" />
                            <span id="avatar-fallback" class="iconify" data-icon="mdi:account-circle" style="font-size: 96px; color:#4fc3f7;"></span>
                            <small style="color:#b0b0b0">PNG/JPG recommended</small>
                        </div>
                        <div style="flex:1; min-width:280px; max-width:520px;">
                            <form id="profile-form" class="profile-info">
                                <input type="hidden" id="csrf_token_profile" name="csrf_token" />
                                <div class="form-group">
                                    <label for="profile-username">Username</label>
                                    <input type="text" id="profile-username" name="username" class="form-input" placeholder="Your username" required>
                                </div>
                                <div class="form-group">
                                    <label for="profile-email">Email</label>
                                    <input type="email" id="profile-email" name="email" class="form-input" placeholder="you@example.com" required>
                                </div>
                                <div class="form-group">
                                    <label for="profile-avatar">Avatar URL</label>
                                    <input type="url" id="profile-avatar" name="avatar" class="form-input" placeholder="https://...">
                                </div>
                                <div style="display:flex; gap:12px; align-items:center;">
                                    <button type="submit" class="btn btn-primary" id="profile-save">Save Changes</button>
                                    <button type="button" class="btn btn-secondary" id="profile-cancel">Reset</button>
                                    <span id="profile-feedback" style="color:#4fc3f7;"></span>
                                </div>
                            </form>
                            <div style="height:1px; background:#24314d; margin:20px 0;"></div>
                            <details style="background:#121a2b; border:1px solid #24314d; border-radius:12px; padding:14px;">
                                <summary style="cursor:pointer; color:#4fc3f7; font-weight:600;">Change Password</summary>
                                <form id="password-form" style="margin-top:12px; display:grid; gap:10px; max-width:520px;">
                                    <input type="hidden" id="csrf_token_password" name="csrf_token" />
                                    <div class="form-group">
                                        <label for="old-password">Current Password</label>
                                        <input type="password" id="old-password" name="old_password" class="form-input" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="new-password">New Password</label>
                                        <input type="password" id="new-password" name="new_password" class="form-input" required>
                                        <div id="pw-strength" style="height:6px; background:#0e1424; border-radius:999px; overflow:hidden; margin-top:6px;">
                                            <div id="pw-bar" style="height:100%; width:0%; background:linear-gradient(90deg,#f44336,#ffb300,#4caf50); transition:width .2s ease;"></div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="confirm-password">Confirm New Password</label>
                                        <input type="password" id="confirm-password" name="confirm_password" class="form-input" required>
                                    </div>
                                    <div style="display:flex; gap:12px; align-items:center;">
                                        <button type="submit" class="btn btn-primary" id="password-save">Update Password</button>
                                        <span id="password-feedback" style="color:#4fc3f7;"></span>
                                    </div>
                                </form>
                            </details>
                        </div>
                    </div>
                </section>

                <!-- Settings Section -->
                <section class="content-section" id="settings-section">
                    <div class="section-header">
                        <h2 class="section-title">Settings</h2>
                        <p class="section-subtitle">Personalize your experience and privacy.</p>
                    </div>
                    <div class="settings-content" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:20px; align-items:start;">
                        <form id="settings-form" style="background:#121a2b; border:1px solid #24314d; border-radius:12px; padding:16px;">
                            <input type="hidden" id="csrf_token_settings" name="csrf_token" />
                            <h3 style="margin-top:0; color:#4fc3f7;">Preferences</h3>
                            <div class="form-group">
                                <label for="setting-theme">Theme</label>
                                <select id="setting-theme" name="theme">
                                    <option value="dark">Dark</option>
                                    <option value="light">Light</option>
                                </select>
                            </div>
                            <div class="form-group" style="display:flex; align-items:center; gap:8px;">
                                <input type="checkbox" id="setting-email" name="email_notifications" checked>
                                <label for="setting-email" style="margin:0;">Email Notifications</label>
                            </div>
                            <div class="form-group" style="display:flex; align-items:center; gap:8px;">
                                <input type="checkbox" id="setting-online" name="show_online" checked>
                                <label for="setting-online" style="margin:0;">Show Online Status</label>
                            </div>
                            <div style="display:flex; gap:12px; align-items:center;">
                                <button type="submit" class="btn btn-primary" id="settings-save">Save Settings</button>
                                <button type="button" class="btn btn-secondary" id="settings-cancel">Reset</button>
                                <span id="settings-feedback" style="color:#4fc3f7;"></span>
                            </div>
                        </form>
                        <div style="background:#121a2b; border:1px solid #24314d; border-radius:12px; padding:16px;">
                            <h3 style="margin-top:0; color:#ffb300;">Danger Zone</h3>
                            <p style="color:#b0b0b0; margin-top:0;">Deleting your account is irreversible. All your data will be permanently removed.</p>
                            <button class="btn btn-secondary" id="delete-account-btn" style="border-color:#f44336; color:#f44336;">Delete Account</button>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        const API_BASE = (window.location.port === '5500') ? 'http://127.0.0.1:8000' : window.location.origin;
        // Navigation functionality
        document.querySelectorAll('.menu-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all links and sections
                document.querySelectorAll('.menu-link').forEach(l => l.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                
                // Add active class to clicked link
                this.classList.add('active');
                
                // Show corresponding section
                const sectionId = this.getAttribute('data-section') + '-section';
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.add('active');
                }
                
                // Update page title
                const pageTitle = document.getElementById('pageTitle');
                const sectionName = this.querySelector('span').textContent;
                pageTitle.textContent = sectionName;
            });
        });

        // Sidebar toggle with persistence
        const layoutEl = document.querySelector('.dashboard-layout');
        const sidebarToggleBtn = document.getElementById('sidebarToggle');
        // Apply persisted state on load
        try {
            const savedCollapsed = localStorage.getItem('sidebarCollapsed');
            if (savedCollapsed === 'true') {
                layoutEl.classList.add('sidebar-collapsed');
            }
        } catch (e) { /* ignore storage errors */ }
        sidebarToggleBtn.addEventListener('click', function() {
            layoutEl.classList.toggle('sidebar-collapsed');
            try {
                localStorage.setItem('sidebarCollapsed', layoutEl.classList.contains('sidebar-collapsed'));
            } catch (e) { /* ignore storage errors */ }
        });

        // Download functionality
        // Simple launcher URLs map (update these when real launcher URLs are ready)
        const LAUNCHER_URLS = {
            windows: {
                direct: 'https://github.com/bleu0-teem/client/releases/download/nightly/BLUE16Client-nightly.zip',
                ad: 'https://tpi.li/BLUE16NightlyRelease'
            },
            mac: {
                direct: 'https://github.com/blue16-team/blue16-web/raw/refs/heads/main/www/src/files/clients/InteractivePhysics.zip',
                ad: 'http://adfoc.us/8737011'
            },
            linux: {
                direct: 'https://github.com/blue16-team/blue16-web/raw/refs/heads/main/www/src/files/clients/InteractivePhysics.zip',
                ad: 'https://github.com/blue16-team/blue16-web/raw/refs/heads/main/www/src/files/clients/InteractivePhysics.zip?ad=1'
            }
        };
        function startDownload(url) {
            try {
                // Visual feedback
                showDownloadAnimation('Starting download...');
                // Trigger browser download
                const a = document.createElement('a');
                a.href = url;
                a.target = '_blank';
                a.rel = 'noopener';
                document.body.appendChild(a);
                a.click();
                a.remove();
            } catch (e) {
                console.error('Download failed', e);
                alert('Failed to start download. Please try again.');
            }
        }

        // File upload functionality
        document.querySelector('.upload-btn').addEventListener('click', function() {
            document.getElementById('fileInput').click();
        });

        document.getElementById('fileInput').addEventListener('change', function() {
            if (this.files.length > 0) {
                alert(`Selected ${this.files.length} file(s) for upload`);
                // Implement actual upload logic here
            }
        });

        // Notification functionality
        document.querySelectorAll('.notification-action').forEach(btn => {
            btn.addEventListener('click', function() {
                const notification = this.closest('.notification-item');
                notification.classList.remove('unread');
                this.style.display = 'none';
            });
        });

        // Download prompt logic
        let currentPlatform = null;
        function showDownloadPrompt(platform) {
            currentPlatform = platform;
            document.getElementById('downloadPromptModal').style.display = 'flex';
        }
        function closeDownloadPrompt() {
            document.getElementById('downloadPromptModal').style.display = 'none';
            currentPlatform = null;
        }
        // Hook up download prompt buttons
        const directBtn = document.getElementById('directDownloadBtn');
        const adBtn = document.getElementById('adDownloadBtn');
        if (directBtn) {
            directBtn.onclick = function() {
                if (!currentPlatform || !LAUNCHER_URLS[currentPlatform]) {
                    alert('Unknown platform. Please choose Windows, MacOS, or Linux.');
                    return;
                }
                const url = LAUNCHER_URLS[currentPlatform].direct;
                closeDownloadPrompt();
                startDownload(url);
            };
        }
        if (adBtn) {
            adBtn.onclick = function() {
                if (!currentPlatform || !LAUNCHER_URLS[currentPlatform]) {
                    alert('Unknown platform. Please choose Windows, MacOS, or Linux.');
                    return;
                }
                const adUrl = LAUNCHER_URLS[currentPlatform].ad;
                // Open ad-supported page first (placeholder), then start download
                window.open(adUrl, '_blank', 'noopener');
                closeDownloadPrompt();
                // Optionally delay to simulate viewing an ad
                setTimeout(() => startDownload(LAUNCHER_URLS[currentPlatform].direct), 800);
            };
        }

        // Profile, Password, and Settings logic
        const profileForm = document.getElementById('profile-form');
        const profileFeedback = document.getElementById('profile-feedback');
        const passwordForm = document.getElementById('password-form');
        const passwordFeedback = document.getElementById('password-feedback');
        const settingsForm = document.getElementById('settings-form');
        const settingsFeedback = document.getElementById('settings-feedback');

        const avatarInput = document.getElementById('profile-avatar');
        const avatarImg = document.getElementById('avatar-preview');
        const avatarFallback = document.getElementById('avatar-fallback');

        // Helpers
        function notify(el, msg, ok=true){
            if (!el) return;
            el.textContent = msg;
            el.style.color = ok ? '#4fc3f7' : '#f44336';
        }
        function authHeaders(csrf){
            const token = localStorage.getItem('auth_token') || localStorage.getItem('token');
            const h = { 'Content-Type': 'application/json' };
            if (token) h['Authorization'] = `Bearer ${token}`;
            if (csrf) h['X-CSRF-Token'] = csrf;
            return h;
        }
        async function tryPost(paths, body, csrf){
            for (const p of paths){
                try {
                    const res = await fetch(`${API_BASE}${p}`, {
                        method: 'POST',
                        headers: authHeaders(csrf),
                        credentials: 'include',
                        body: JSON.stringify(body)
                    });
                    if (res.ok){
                        const data = await res.json().catch(()=>({ ok:true }));
                        return { ok:true, data };
                    }
                } catch (e){ /* try next */ }
            }
            return { ok:false };
        }

        // Avatar preview
        function updateAvatarPreview(url){
            if (url && /^https?:\/\//i.test(url)){
                avatarImg.style.display = 'block';
                avatarFallback.style.display = 'none';
                avatarImg.src = url;
            } else {
                avatarImg.style.display = 'none';
                avatarFallback.style.display = 'block';
                avatarImg.src = '';
            }
        }
        if (avatarInput){
            avatarInput.addEventListener('input', (e)=> updateAvatarPreview(e.target.value.trim()));
            avatarImg.addEventListener('error', ()=>{
                avatarImg.style.display = 'none';
                avatarFallback.style.display = 'block';
            });
        }

        // Load user profile (from API or localStorage)
        async function loadProfile(){
            const usernameEl = document.getElementById('profile-username');
            const emailEl = document.getElementById('profile-email');
            const avatarEl = document.getElementById('profile-avatar');
            let loaded = false;
            try {
                const res = await fetch(`${API_BASE}/api/me.php`, { credentials: 'include', cache: 'no-store' });
                if (res.ok){
                    const me = await res.json();
                    if (me){
                        if (me.username) usernameEl.value = me.username;
                        if (me.email) emailEl.value = me.email;
                        if (me.avatar) { avatarEl.value = me.avatar; updateAvatarPreview(me.avatar); }
                        loaded = true;
                    }
                }
            } catch(e){ /* ignore */ }
            if (!loaded){
                const saved = JSON.parse(localStorage.getItem('user_profile')||'{}');
                if (saved.username) usernameEl.value = saved.username;
                if (saved.email) emailEl.value = saved.email;
                if (saved.avatar){ avatarEl.value = saved.avatar; updateAvatarPreview(saved.avatar); }
            }
        }
        loadProfile();

        // Profile save
        profileForm?.addEventListener('submit', async (e)=>{
            e.preventDefault();
            notify(profileFeedback, 'Saving...');
            const body = {
                username: document.getElementById('profile-username').value.trim(),
                email: document.getElementById('profile-email').value.trim(),
                avatar: document.getElementById('profile-avatar').value.trim(),
            };
            if (!body.username || !body.email){
                notify(profileFeedback, 'Username and email are required.', false);
                return;
            }
            const csrf = (document.getElementById('csrf_token_profile')||{}).value;
            const result = await tryPost([
                '/api/update_profile.php',
                '/api/profile/update.php',
                '/api/user/update.php'
            ], body, csrf);
            if (result.ok){
                localStorage.setItem('user_profile', JSON.stringify(body));
                notify(profileFeedback, 'Profile updated!');
            } else {
                // Fallback to local save
                localStorage.setItem('user_profile', JSON.stringify(body));
                notify(profileFeedback, 'Saved locally (offline). Will sync when online.');
            }
        });
        document.getElementById('profile-cancel')?.addEventListener('click', ()=>{
            profileForm.reset();
            notify(profileFeedback, 'Changes reverted.');
            loadProfile();
        });

        // Password strength meter
        const pw = document.getElementById('new-password');
        const pwBar = document.getElementById('pw-bar');
        function scorePassword(s){
            let score = 0;
            if (!s) return 0;
            const letters = {};
            for (let i=0; i<s.length; i++){ letters[s[i]] = (letters[s[i]]||0) + 1; score += 5.0/letters[s[i]]; }
            const variations = { digits: /\d/.test(s), lower: /[a-z]/.test(s), upper: /[A-Z]/.test(s), nonWords: /[^\w]/.test(s) };
            let variationCount = 0; for (let k in variations){ variationCount += variations[k] ? 1 : 0; }
            score += (variationCount-1) * 10;
            return parseInt(score);
        }
        pw?.addEventListener('input', (e)=>{
            const sc = Math.max(0, Math.min(100, scorePassword(e.target.value)));
            if (pwBar) pwBar.style.width = sc + '%';
        });

        // Change Password
        passwordForm?.addEventListener('submit', async (e)=>{
            e.preventDefault();
            notify(passwordFeedback, 'Updating password...');
            const oldp = document.getElementById('old-password').value;
            const newp = document.getElementById('new-password').value;
            const conf = document.getElementById('confirm-password').value;
            if (newp !== conf){ notify(passwordFeedback, 'Passwords do not match.', false); return; }
            if ((scorePassword(newp)||0) < 40){ notify(passwordFeedback, 'Password too weak. Use more characters and symbols.', false); return; }
            const csrf = (document.getElementById('csrf_token_password')||{}).value;
            const result = await tryPost([
                '/api/change_password.php',
                '/api/user/change_password.php'
            ], { old_password: oldp, new_password: newp }, csrf);
            if (result.ok){
                notify(passwordFeedback, 'Password updated!');
                passwordForm.reset();
                if (pwBar) pwBar.style.width = '0%';
            } else {
                notify(passwordFeedback, 'Unable to update password right now.', false);
            }
        });

        // Settings load and save
        function applyTheme(theme){
            const t = theme === 'light' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', t);
        }
        function loadSettings(){
            const saved = JSON.parse(localStorage.getItem('user_settings')||'{}');
            if (saved.theme) { document.getElementById('setting-theme').value = saved.theme; applyTheme(saved.theme); }
            if (typeof saved.email_notifications === 'boolean') document.getElementById('setting-email').checked = saved.email_notifications;
            if (typeof saved.show_online === 'boolean') document.getElementById('setting-online').checked = saved.show_online;
        }
        loadSettings();

        settingsForm?.addEventListener('submit', async (e)=>{
            e.preventDefault();
            notify(settingsFeedback, 'Saving settings...');
            const body = {
                theme: document.getElementById('setting-theme').value,
                email_notifications: document.getElementById('setting-email').checked,
                show_online: document.getElementById('setting-online').checked,
            };
            applyTheme(body.theme);
            localStorage.setItem('user_settings', JSON.stringify(body));
            const csrf = (document.getElementById('csrf_token_settings')||{}).value;
            const result = await tryPost([
                '/api/settings.php',
                '/api/user/settings.php'
            ], body, csrf);
            if (result.ok){
                notify(settingsFeedback, 'Settings updated!');
            } else {
                notify(settingsFeedback, 'Saved locally. Will sync when online.');
            }
        });
        document.getElementById('settings-cancel')?.addEventListener('click', ()=>{
            loadSettings();
            notify(settingsFeedback, 'Reverted changes');
        });
        // Logout button logic
        const logoutBtn = document.querySelector('.menu-link[href="../index.html"]');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                // Simulate session clear
                localStorage.clear();
                sessionStorage.clear();
                document.cookie = '';
                window.location.href = '../index.html';
            });
        }
        // Download animation
        function showDownloadAnimation(text) {
            const anim = document.createElement('div');
            anim.style.position = 'fixed';
            anim.style.top = '0';
            anim.style.left = '0';
            anim.style.width = '100vw';
            anim.style.height = '100vh';
            anim.style.background = 'rgba(10,20,40,0.7)';
            anim.style.zIndex = '9999';
            anim.style.display = 'flex';
            anim.style.alignItems = 'center';
            anim.style.justifyContent = 'center';
            anim.innerHTML = `<div style="background:#1e2940; border-radius:16px; padding:28px 22px; max-width:360px; margin:auto; box-shadow:0 8px 32px rgba(33,150,243,0.18); text-align:center;">
                <div style='color:#4fc3f7; font-size:1.1rem; margin-bottom:12px;'>${text}</div>
                <div style='height:10px; background:#102033; border-radius:999px; overflow:hidden;'>
                  <div id='dl-progress' style='height:100%; width:0%; background:linear-gradient(90deg,#4fc3f7,#2196f3); box-shadow:0 0 12px #4fc3f7AA inset; transition:width .25s ease;'></div>
                </div>
                <div style='color:#b0b0b0; margin-top:10px;'>Preparing your download...</div>
            </div>`;
            document.body.appendChild(anim);
            // Fake progress then remove
            let p = 0;
            const bar = anim.querySelector('#dl-progress');
            const timer = setInterval(() => {
                p = Math.min(100, p + 20);
                if (bar) bar.style.width = p + '%';
                if (p >= 100) {
                    clearInterval(timer);
                    setTimeout(() => anim.remove(), 300);
                }
            }, 250);
        }
        // Bell button opens notifications section
        const notificationsBtn = document.getElementById('notificationsBtn');
        notificationsBtn.addEventListener('click', function() {
            document.querySelectorAll('.menu-link').forEach(l => l.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            // Highlight sidebar notifications link
            const sidebarNotif = document.querySelector('.menu-link[data-section="notifications"]');
            if (sidebarNotif) sidebarNotif.classList.add('active');
            // Show notifications section
            const notifSection = document.getElementById('notifications-section');
            if (notifSection) notifSection.classList.add('active');
            // Update page title
            document.getElementById('pageTitle').textContent = 'Notifications';
        });
        // Profile button opens profile section
        const profileBtn = document.getElementById('profileBtn');
        profileBtn.addEventListener('click', function() {
            document.querySelectorAll('.menu-link').forEach(l => l.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            const sidebarProfile = document.querySelector('.menu-link[data-section="profile"]');
            if (sidebarProfile) sidebarProfile.classList.add('active');
            const profileSection = document.getElementById('profile-section');
            if (profileSection) profileSection.classList.add('active');
            document.getElementById('pageTitle').textContent = 'Profile';
        });

        // Server Status: visually distinct (add a border and shadow)
        document.addEventListener('DOMContentLoaded', function() {
            const serverStatusCard = document.querySelector('#dashboard-section .server-status');
            if (serverStatusCard) {
                serverStatusCard.style.border = '2px solid #4fc3f7';
                serverStatusCard.style.boxShadow = '0 0 16px 0 #4fc3f7cc';
                serverStatusCard.style.background = 'rgba(33,150,243,0.08)';
                serverStatusCard.style.borderRadius = '18px';
            }

            // Command Palette (Ctrl/Cmd+K) for quick navigation
            const palette = document.createElement('div');
            palette.id = 'cmdk';
            palette.style.cssText = 'display:none; position:fixed; inset:0; z-index:10000; background:rgba(10,20,40,.6); align-items:flex-start; justify-content:center; padding-top:10vh;';
            palette.innerHTML = `
              <div style="width:560px; max-width:90vw; background:#121a2b; border:1px solid #24314d; border-radius:14px; overflow:hidden; box-shadow:0 12px 40px rgba(33,150,243,.25)">
                <div style="display:flex; align-items:center; gap:8px; padding:10px 12px; border-bottom:1px solid #1a253c;">
                  <span class="iconify" data-icon="mdi:magnify" style="color:#4fc3f7"></span>
                  <input id="cmdk-input" type="text" placeholder="Type a command... (e.g., download, servers, profile)" style="flex:1; background:transparent; border:none; outline:none; color:#e0e0e0; font-size:14px;" />
                  <span style="color:#6ea9c7; font-size:12px; opacity:.8;">Esc</span>
                </div>
                <div id="cmdk-list" style="max-height:50vh; overflow:auto;">
                </div>
              </div>`;
            document.body.appendChild(palette);

            const entries = [
              {label:'Dashboard', key:'dashboard'},
              {label:'Download', key:'download'},
              {label:'Files', key:'files'},
              {label:'Games', key:'games'},
              {label:'Servers', key:'servers'},
              {label:'Invites', key:'invites'},
              {label:'Notifications', key:'notifications'},
              {label:'Profile', key:'profile'},
              {label:'Settings', key:'settings'}
            ];
            function renderList(filter=''){
              const list = document.getElementById('cmdk-list');
              const q = filter.trim().toLowerCase();
              const filtered = entries.filter(e => e.label.toLowerCase().includes(q) || e.key.includes(q));
              list.innerHTML = filtered.map((e,i)=>`<div class="cmdk-item${i===0?' selected':''}" data-key="${e.key}" style="display:flex; gap:10px; padding:10px 12px; cursor:pointer; align-items:center; background:${i===0?'#0f1524':'transparent'};"> <span class="iconify" data-icon="mdi:chevron-right" style="color:#4fc3f7"></span> <div style="color:#d5e7f4">${e.label}</div></div>`).join('');
            }
            function openPalette(){ palette.style.display='flex'; const input=document.getElementById('cmdk-input'); renderList(''); setTimeout(()=>input.focus(),0); }
            function closePalette(){ palette.style.display='none'; }
            function activate(key){
              closePalette();
              const link = document.querySelector(`.menu-link[data-section="${key}"]`);
              if (link) link.click();
            }
            document.addEventListener('keydown', (e)=>{
              const metaK = (e.ctrlKey || e.metaKey) && (e.key.toLowerCase()==='k');
              if (metaK){ e.preventDefault(); openPalette(); }
              if (palette.style.display!=='none'){
                if (e.key==='Escape'){ closePalette(); }
                if (e.key==='Enter'){
                  const selected = document.querySelector('#cmdk-list .cmdk-item.selected');
                  if (selected) activate(selected.getAttribute('data-key'));
                }
                if (e.key==='ArrowDown' || e.key==='Tab'){
                  e.preventDefault();
                  const items=[...document.querySelectorAll('#cmdk-list .cmdk-item')];
                  const idx=items.findIndex(i=>i.classList.contains('selected'));
                  items.forEach(i=>i.classList.remove('selected'));
                  const next=items[Math.min(items.length-1, idx+1)];
                  if (next) next.classList.add('selected');
                }
                if (e.key==='ArrowUp'){
                  e.preventDefault();
                  const items=[...document.querySelectorAll('#cmdk-list .cmdk-item')];
                  const idx=items.findIndex(i=>i.classList.contains('selected'));
                  items.forEach(i=>i.classList.remove('selected'));
                  const prev=items[Math.max(0, idx-1)];
                  if (prev) prev.classList.add('selected');
                }
              }
            });
            document.addEventListener('input', (e)=>{
              if (e.target && e.target.id==='cmdk-input') renderList(e.target.value);
            });
            document.getElementById('cmdk-list').addEventListener('click', (e)=>{
              const el = e.target.closest('.cmdk-item');
              if (el) activate(el.getAttribute('data-key'));
            });
        });
    </script>
    <script>
        // Live Server Status polling and rendering
        (function(){
            const STATUS_CLASSES = ['online','offline','maintenance'];
            const mapKeyToDom = {
                main: { ind: 'status-main-ind', details: 'status-main-details', label: 'Main Server' },
                game: { ind: 'status-game-ind', details: 'status-game-details', label: 'Game Server' },
                file: { ind: 'status-file-ind', details: 'status-file-details', label: 'File Server' },
            };
            function setIndicator(id, status){
                const el = document.getElementById(id);
                if (!el) return;
                STATUS_CLASSES.forEach(c=>el.classList.remove(c));
                if (status && STATUS_CLASSES.includes(status)) el.classList.add(status);
            }
            function setDetails(id, text){
                const el = document.getElementById(id);
                if (el) el.textContent = text;
            }
            async function fetchStatus(){
                try {
                    const res = await fetch('/api/health.php', { cache: 'no-store', credentials: 'include' });
                    const data = await res.json();
                    const services = data && data.services ? data.services : {};
                    for (const key of Object.keys(mapKeyToDom)){
                        const cfg = mapKeyToDom[key];
                        const svc = services[key] || { status: 'offline', details: 'No data' };
                        const status = (svc.status||'offline').toLowerCase();
                        setIndicator(cfg.ind, status);
                        let detail = '';
                        if (status === 'online'){
                            const latency = (svc.latency_ms!=null) ? `~${svc.latency_ms} ms` : null;
                            const players = (typeof svc.players === 'number' && svc.players > 0) ? `${svc.players} players` : null;
                            detail = ['Online', latency, players].filter(Boolean).join(' · ');
                            if (!detail) detail = 'Online';
                        } else if (status === 'maintenance') {
                            detail = 'Maintenance';
                        } else {
                            detail = 'Offline';
                        }
                        if (svc.details && status !== 'online') {
                            detail += ` · ${svc.details}`;
                        }
                        setDetails(cfg.details, detail);
                    }
                } catch (e){
                    // On error mark all as offline (without overriding explicit maintenance)
                    Object.keys(mapKeyToDom).forEach(key=>{
                        const cfg = mapKeyToDom[key];
                        const ind = document.getElementById(cfg.ind);
                        if (ind && !ind.classList.contains('maintenance')){
                            setIndicator(cfg.ind, 'offline');
                            setDetails(cfg.details, 'Offline · Unable to reach status API');
                        }
                    });
                }
            }
            document.addEventListener('DOMContentLoaded', ()=>{
                // Initialize as checking state
                fetchStatus();
                // Poll every 15 seconds
                setInterval(fetchStatus, 15000);
            });
        })();
    </script>
    <script>
        // Fetch CSRF token and set it in all related forms
        const fetchCsrfToken = async () => {
            try {
                const res = await fetch(`${API_BASE}/api/csrf_token.php`, {
                    credentials: 'include',
                    cache: 'no-store'
                });
                const data = await res.json();
                if (data && data.csrf_token) {
                    const tok = data.csrf_token;
                    const s = document.getElementById('csrf_token_settings');
                    const p = document.getElementById('csrf_token_profile');
                    const pw = document.getElementById('csrf_token_password');
                    if (s) s.value = tok;
                    if (p) p.value = tok;
                    if (pw) pw.value = tok;
                }
            } catch (e) {
                console.error('Failed to load CSRF token', e);
                setTimeout(fetchCsrfToken, 2000);
            }
        };
        fetchCsrfToken();

        // Delete account
        (function(){
            const btn = document.getElementById('delete-account-btn');
            if (!btn) return;
            btn.addEventListener('click', async ()=>{
                if (!confirm('Are you sure you want to permanently delete your account? This cannot be undone.')) return;
                btn.disabled = true;
                try {
                    const csrf = (document.getElementById('csrf_token_settings')||{}).value;
                    const res = await fetch(`${API_BASE}/api/delete_account.php`, {
                        method: 'POST',
                        headers: (function(){
                            const token = localStorage.getItem('auth_token') || localStorage.getItem('token');
                            const h = { 'Content-Type': 'application/json' };
                            if (token) h['Authorization'] = `Bearer ${token}`;
                            if (csrf) h['X-CSRF-Token'] = csrf;
                            return h;
                        })(),
                        credentials: 'include',
                        body: JSON.stringify({ confirm: true })
                    });
                    if (res.ok){
                        alert('Account deleted. Sorry to see you go.');
                        localStorage.clear(); sessionStorage.clear();
                        window.location.href = '../index.html';
                    } else {
                        alert('Unable to delete account right now. Please try again later.');
                        btn.disabled = false;
                    }
                } catch(e){
                    alert('Network error. Please try again later.');
                    btn.disabled = false;
                }
            });
        })();
    </script>
</body>
</html>